 



<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ù ‡¶Ö‡¶®‡¶æ‡¶•‡¶∏‡ßá‡¶¨‡¶æ | Street Children Food Distribution System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #2563eb; --secondary: #059669; --danger: #dc2626;
            --warning: #f59e0b; --dark: #1e293b; --light: #f1f5f9; --white: #ffffff;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--light); color: var(--dark); line-height: 1.6; }
        .navbar { background: linear-gradient(135deg, #2b8781, #1b3485); color: var(--white); padding: 1rem 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .nav-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .logo { font-size: 1.5rem; font-weight: bold; }
        .nav-links { display: flex; gap: 1.5rem; list-style: none; flex-wrap: wrap; }
        .nav-links a { color: var(--white); text-decoration: none; transition: opacity 0.3s; cursor: pointer; }
        .nav-links a:hover { opacity: 0.8; }
        .hero { background: linear-gradient(322deg, #263125 0%, #68e1b4 100%); color: var(--white); padding: 4rem 0; text-align: center; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 1rem; }
        .hero p { font-size: 1.2rem; opacity: 0.9; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .stat-card { background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-number { font-size: 2.5rem; font-weight: bold; color: var(--primary); display: block; margin-bottom: 0.5rem; }
        .stat-label { color: #64748b; font-size: 0.9rem; }
        .section { padding: 3rem 0; }
        .section-title { font-size: 2rem; margin-bottom: 2rem; text-align: center; color: var(--dark); }
        .card { background: var(--white); border-radius: 10px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 1.5rem; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 1rem; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: var(--light); font-weight: 600; color: var(--dark); }
        tr:hover { background: #f8fafc; }
        .badge { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
        .badge-success { background: #d1fae5; color: var(--secondary); }
        .badge-warning { background: #fef3c7; color: #d97706; }
        .badge-danger { background: #fee2e2; color: var(--danger); }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s; }
        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-primary:hover { background: #1e40af; }
        .btn-success { background: var(--secondary); color: var(--white); }
        .emergency-alert { background: linear-gradient(135deg, #dc2626, #991b1b); color: var(--white); padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 5px; font-size: 1rem; }
        .form-group textarea { min-height: 120px; resize: vertical; }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .donation-option { background: var(--white); padding: 2rem; border-radius: 10px; border: 2px solid var(--light); cursor: pointer; transition: all 0.3s; text-align: center; }
        .donation-option:hover { border-color: var(--primary); transform: translateY(-5px); }
        .donation-option.selected { border-color: var(--primary); background: #eff6ff; }
        .impact-counter { font-size: 3rem; font-weight: bold; color: var(--secondary); text-align: center; margin: 2rem 0; }
        .alert { padding: 1rem; border-radius: 5px; margin-bottom: 1rem; }
        .alert-success { background: #d1fae5; color: var(--secondary); border-left: 4px solid var(--secondary); }
        .alert-info { background: #dbeafe; color: var(--primary); border-left: 4px solid var(--primary); }
        .filter-section { background: var(--white); padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap; align-items: end; }
        .filter-group { flex: 1; min-width: 200px; }
        .donation-text { background: linear-gradient(135deg, #eff6ff, #dbeafe); padding: 2rem; border-radius: 10px; margin-bottom: 2rem; border-left: 4px solid var(--primary); }
        .donation-text h3 { color: var(--primary); margin-bottom: 1rem; }
        .donation-text p { margin-bottom: 0.8rem; line-height: 1.8; }
        .page-section { display: none; }
        .page-section.active { display: block; }
        .live-feed { background: #000; border-radius: 10px; padding: 1rem; text-align: center; }
        .live-badge { display: inline-block; background: var(--danger); color: var(--white); padding: 0.5rem 1rem; border-radius: 20px; margin-bottom: 1rem; animation: pulse 2s infinite; }
        .loading { text-align: center; padding: 2rem; color: #666; }
        .employee-item { background: #f8f9fa; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .meal-dots { display: flex; gap: 5px; }
        .meal-dot { width: 25px; height: 25px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 0.75em; font-weight: bold; }
        .meal-dot.taken { background: #28a745; color: white; }
        .fire-alert-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center; }
        .fire-alert-modal.active { display: flex; animation: fireFlash 1s infinite; }
        @keyframes fireFlash { 0%, 100% { background: rgba(139, 0, 0, 0.95); } 50% { background: rgba(255, 69, 0, 0.95); } }
        .fire-alert-content { background: linear-gradient(135deg, #ff4500, #8b0000); color: white; padding: 3rem; border-radius: 20px; text-align: center; max-width: 600px; box-shadow: 0 0 50px rgba(255, 69, 0, 0.8); animation: shake 0.5s infinite; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        .fire-icon { font-size: 5rem; margin-bottom: 1rem; animation: burn 1s infinite; }
        @keyframes burn { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        @media (max-width: 768px) {
            .nav-links { gap: 0.8rem; font-size: 0.9rem; }
            .hero h1 { font-size: 1.8rem; }
            .stat-number { font-size: 2rem; }
            .filter-section { flex-direction: column; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <div class="logo">ü§ù ‡¶Ö‡¶®‡¶æ‡¶•‡¶∏‡ßá‡¶¨‡¶æ</div>
                <ul class="nav-links">
                    <li><a onclick="showSection('home')">Home</a></li>
                    <li><a onclick="showSection('tracking')">Tracking</a></li>
                    <li><a onclick="showSection('tender')">Tender</a></li>
                    <li><a onclick="showSection('donation')">Donation</a></li>
                    <li><a onclick="showSection('police')">Police Portal</a></li>
                    <li><a onclick="showSection('fire')">Fire Service</a></li>
                    <li><a href="https://mehedi-hasan-soft-web-support.github.io/SDG/" target="_blank">SDG Charter</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="home" class="page-section active">
        <div class="hero">
            <div class="container">
                <h1>‡¶ï‡ßç‡¶∑‡ßÅ‡¶ß‡¶æ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§ ‡¶∂‡¶ø‡¶∂‡ßÅ‡¶á ‡¶π‡ßã‡¶ï ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶ô‡ßç‡¶ó‡ßÄ‡¶ï‡¶æ‡¶∞</h1>
                <p>RFID-‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶¶‡ßç‡¶Ø ‡¶¨‡¶ø‡¶§‡¶∞‡¶£ ‡¶ì ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ</p>
                <div class="impact-counter" id="impactCounter">0</div>
                <p>‡¶∂‡¶ø‡¶∂‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡ßá ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>
            </div>
        </div>
        <div class="container section">
            <div class="stats-grid">
                <div class="stat-card"><span class="stat-number" id="todayMeals">0</span><span class="stat-label">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶§‡¶∞‡¶£</span></div>
                <div class="stat-card"><span class="stat-number" id="monthMeals">0</span><span class="stat-label">‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶Æ‡ßã‡¶ü</span></div>
                <div class="stat-card"><span class="stat-number" id="activeMachines">1</span><span class="stat-label">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶≠‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Æ‡ßá‡¶∂‡¶ø‡¶®</span></div>
                <div class="stat-card"><span class="stat-number" id="emergencyHandled">0</span><span class="stat-label">‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶ø‡¶§</span></div>
            </div>
            <div class="card">
                <h2 class="section-title">‡¶≠‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Æ‡ßá‡¶∂‡¶ø‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®</h2>
                <div style="height:400px; padding:0; overflow:hidden; border-radius:10px;">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d14609.36137408862!2d90.40860609554413!3d23.735239800267383!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3755b85c4ff4a595%3A0xe44a0b0603ae39c2!2sMotijheel%2C%20Dhaka!5e0!3m2!1sen!2sbd!4v1766492443000!5m2!1sen!2sbd" width="100%" height="100%" style="border:0;" allowfullscreen loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </div>

    <div id="tracking" class="page-section">
        <div class="container section">
            <h2 class="section-title">Smart ‡¶ñ‡¶æ‡¶¶‡ßç‡¶Ø ‡¶¨‡¶ø‡¶§‡¶∞‡¶£ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</h2>
            <div class="filter-section">
                <div class="filter-group">
                    <button class="btn btn-primary" onclick="loadData()">üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <h3 style="color:var(--secondary);">‚úÖ ‡¶Ü‡¶ú ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá</h3>
                    <div id="eatenToday"><div class="loading">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div></div>
                </div>
                
                <div class="card">
                    <h3 style="color:var(--warning);">‚è≥ ‡¶Ü‡¶ú ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶è‡¶ñ‡¶®‡ßã ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</h3>
                    <div id="notEatenToday"><div class="loading">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div></div>
                </div>
            </div>

            <div class="card">
                <h3>Real-time ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Æ‡¶ø‡¶≤ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç</h3>
                <div id="employeeTracking"><div class="loading">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div></div>
            </div>
        </div>
    </div>

    <div id="tender" class="page-section">
        <div class="container section">
            <h2 class="section-title">üçõ ‡¶∞‡ßá‡¶∏‡ßç‡¶§‡ßã‡¶∞‡¶æ‡¶Å ‡¶á-‡¶ü‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h2>
            <div class="card">
                <div class="alert alert-success">
                    <strong>‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞:</strong> ‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø 2026 ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ñ‡¶æ‡¶¶‡ßç‡¶Ø ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π - ‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: 31 ‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞ 2025
                </div>
                <div style="background:#f8fafc;padding:1.5rem;border-radius:8px;margin:1.5rem 0;">
                    <h3 style="margin-bottom:1rem;color:var(--primary);">‡¶ü‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</h3>
                    <p style="margin-bottom:0.8rem;"><strong>üì¶ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</strong> 15,000 ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞/‡¶Æ‡¶æ‡¶∏ (‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ~500 ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞)</p>
                    <p style="margin-bottom:0.8rem;"><strong>ü•ó ‡¶™‡ßÅ‡¶∑‡ßç‡¶ü‡¶ø:</strong> 400-500 ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶∞‡¶ø, ‡¶™‡ßç‡¶∞‡ßã‡¶ü‡¶ø‡¶® 15g+, ‡¶≠‡¶ø‡¶ü‡¶æ‡¶Æ‡¶ø‡¶® A, C ‡¶∏‡¶Æ‡ßÉ‡¶¶‡ßç‡¶ß</p>
                    <p style="margin-bottom:0.8rem;"><strong>üí∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü:</strong> ‡ß≥30-50 ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</p>
                    <p style="margin-bottom:0;"><strong>üìã ‡¶∂‡¶∞‡ßç‡¶§:</strong> ‡¶ñ‡¶æ‡¶¶‡ßç‡¶Ø ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶≤‡¶æ‡¶á‡¶∏‡ßá‡¶®‡ßç‡¶∏ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</p>
                </div>
                <h3 style="margin:2rem 0 1rem;">‡¶¨‡¶ø‡¶° ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</h3>
                <form id="tenderForm" onsubmit="submitTender(event)">
                    <div class="form-group">
                        <label>‡¶∞‡ßá‡¶∏‡ßç‡¶§‡ßã‡¶∞‡¶æ‡¶Å‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                        <input type="text" id="restName" placeholder="‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: ‡¶∏‡ßã‡¶®‡¶æ‡¶≤‡ßÄ ‡¶∞‡ßá‡¶∏‡ßç‡¶§‡ßã‡¶∞‡¶æ‡¶Å" required>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ *</label>
                            <input type="tel" id="restPhone" placeholder="01712345678" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤ *</label>
                            <input type="email" id="restEmail" placeholder="restaurant@example.com" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø (‡ß≥) *</label>
                        <input type="number" id="mealPrice" placeholder="35" min="30" max="50" required>
                    </div>
                    <div class="form-group">
                        <label>‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨‡¶ø‡¶§ ‡¶Æ‡ßá‡¶®‡ßÅ *</label>
                        <textarea id="menuDetails" placeholder="‡¶≠‡¶æ‡¶§, ‡¶°‡¶æ‡¶≤, ‡¶∏‡¶¨‡¶ú‡¶ø, ‡¶°‡¶ø‡¶Æ..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label>‡¶ñ‡¶æ‡¶¶‡ßç‡¶Ø ‡¶≤‡¶æ‡¶á‡¶∏‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ *</label>
                        <input type="text" id="license" placeholder="FSL-123456" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%;padding:1rem;font-size:1.1rem;">üì§ ‡¶¨‡¶ø‡¶° ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
                </form>
                <div style="margin-top:2rem;padding:1.5rem;background:#d1fae5;border-radius:8px;">
                    <h4 style="color:var(--secondary);margin-bottom:0.5rem;">‚úÖ ‡¶∏‡¶´‡¶≤ ‡¶ü‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ú‡¶Æ‡¶æ</h4>
                    <p style="margin:0;color:#047857;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶≤‡ßá 24 ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§</p>
                </div>
            </div>
        </div>
    </div>

    <div id="donation" class="page-section">
        <div class="container section">
            <h2 class="section-title">üíù ‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® - ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∂‡¶ø‡¶∂‡ßÅ‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶¨‡¶¶‡¶≤‡ßá ‡¶¶‡¶ø‡¶®</h2>
            
            <div class="donation-text">
                <h3>‡¶ï‡ßá‡¶® ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡¶æ‡¶® ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£?</h3>
                <p>üåü <strong>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞‡ßã ‡¶™‡¶•‡¶∂‡¶ø‡¶∂‡ßÅ ‡¶ï‡ßç‡¶∑‡ßÅ‡¶ß‡¶æ‡¶∞‡ßç‡¶§ ‡¶ò‡ßÅ‡¶Æ‡¶æ‡¶§‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§</strong> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡ßã‡¶ü‡ßç‡¶ü ‡¶¶‡¶æ‡¶® ‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶®‡ßá ‡¶Ü‡¶≤‡ßã ‡¶ú‡ßç‡¶¨‡¶æ‡¶≤‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</p>
                <p>üçö <strong>‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡ß©‡ß´ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶Ø‡¶º</strong> ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∂‡¶ø‡¶∂‡ßÅ ‡¶è‡¶ï‡¶¨‡ßá‡¶≤‡¶æ ‡¶™‡ßÅ‡¶∑‡ßç‡¶ü‡¶ø‡¶ï‡¶∞ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡¶æ‡¶¨‡ßá - ‡¶≠‡¶æ‡¶§, ‡¶°‡¶æ‡¶≤, ‡¶∏‡¶¨‡¶ú‡¶ø, ‡¶°‡¶ø‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶´‡¶≤‡•§</p>
                <p>üîí <strong>‡ßß‡ß¶‡ß¶% ‡¶∏‡ßç‡¶¨‡¶ö‡ßç‡¶õ‡¶§‡¶æ:</strong> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ü‡¶æ‡¶ï‡¶æ RFID ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡•§</p>
                <p>üíö <strong>SDG ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø:</strong> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡¶æ‡¶® SDG 2 (Zero Hunger) ‡¶Ö‡¶∞‡ßç‡¶ú‡¶®‡ßá ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶§‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá‡•§</p>
            </div>

            <div class="card">
                <h3 style="margin-bottom:1.5rem;color:var(--primary);">‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="grid-2">
                    <div class="donation-option" onclick="selectDonation(this, 500)">
                        <h4 style="color:var(--primary);font-size:1.8rem;margin-bottom:0.5rem;">‡ß≥500</h4>
                        <p style="color:#64748b;">14 ‡¶ú‡¶® ‡¶∂‡¶ø‡¶∂‡ßÅ‡¶ï‡ßá 1 ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</p>
                    </div>
                    <div class="donation-option" onclick="selectDonation(this, 1000)">
                        <h4 style="color:var(--primary);font-size:1.8rem;margin-bottom:0.5rem;">‡ß≥1,000</h4>
                        <p style="color:#64748b;">28 ‡¶ú‡¶® ‡¶∂‡¶ø‡¶∂‡ßÅ‡¶ï‡ßá 1 ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</p>
                    </div>
                    <div class="donation-option" onclick="selectDonation(this, 3000)">
                        <h4 style="color:var(--primary);font-size:1.8rem;margin-bottom:0.5rem;">‡ß≥3,000</h4>
                        <p style="color:#64748b;">1 ‡¶∂‡¶ø‡¶∂‡ßÅ‡¶ï‡ßá 1 ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ (3 ‡¶¨‡ßá‡¶≤‡¶æ √ó 30 ‡¶¶‡¶ø‡¶®)</p>
                    </div>
                    <div class="donation-option" onclick="selectDonation(this, 5000)">
                        <h4 style="color:var(--primary);font-size:1.8rem;margin-bottom:0.5rem;">‡ß≥5,000</h4>
                        <p style="color:#64748b;">142 ‡¶ú‡¶® ‡¶∂‡¶ø‡¶∂‡ßÅ‡¶ï‡ßá 1 ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</p>
                    </div>
                </div>

                <form id="donationForm" onsubmit="submitDonation(event)" style="margin-top:2rem;">
                    <div class="form-group">
                        <label>‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥) *</label>
                        <input type="number" id="donationAmount" placeholder="‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: 1000" min="100" required>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                            <input type="text" id="donorName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤ *</label>
                            <input type="email" id="donorEmail" placeholder="your@email.com" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ *</label>
                        <input type="tel" id="donorPhone" placeholder="01712345678" required>
                    </div>

                    <div style="background:#fff3cd;padding:1.5rem;border-radius:8px;margin:1.5rem 0;border-left:4px solid #f59e0b;">
                        <h4 style="color:#d97706;margin-bottom:1rem;">üì± bKash ‡¶è ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®</h4>
                        <p style="margin-bottom:0.8rem;"><strong>bKash ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</strong> <span style="font-size:1.3rem;color:#d97706;font-weight:bold;">01964301859</span></p>
                        <p style="margin-bottom:0.8rem;"><strong>Account Type:</strong> Personal</p>
                        <p style="margin-bottom:0;color:#666;font-size:0.9rem;">
                            ‚úì Send Money ‡¶ï‡¶∞‡ßÅ‡¶®<br>
                            ‚úì Reference: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®<br>
                            ‚úì ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®
                        </p>
                    </div>

                    <div class="form-group">
                        <label>bKash Transaction ID (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                        <input type="text" id="transactionId" placeholder="‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: 9AB123456X">
                        <small style="color:#64748b;display:block;margin-top:0.3rem;">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞ Transaction ID ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</small>
                    </div>

                    <button type="submit" class="btn btn-success" style="width:100%;font-size:1.2rem;padding:1rem;">
                        üíö ‡¶¶‡¶æ‡¶® ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                </form>

                <div style="margin-top:2rem;padding:1.5rem;background:#d1fae5;border-radius:8px;">
                    <h4 style="color:var(--secondary);margin-bottom:0.5rem;">‚úÖ ‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡ßá</h4>
                    <p style="margin:0;color:#047857;">‡¶Ü‡¶Æ‡¶∞‡¶æ 24 ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶∞‡¶∏‡¶ø‡¶¶ ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶ï‡¶§‡¶ú‡¶® ‡¶∂‡¶ø‡¶∂‡ßÅ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</p>
                </div>
            </div>

            <div class="card" style="margin-top:2rem;">
                <h3 style="margin-bottom:1rem;">‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶ö‡ßç‡¶õ‡¶§‡¶æ ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" style="color:var(--secondary);">‡ß≥4,52,000</span>
                        <span class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶¶‡¶æ‡¶® ‡¶∏‡¶Ç‡¶ó‡ßÉ‡¶π‡ßÄ‡¶§</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" style="color:var(--secondary);">12,914</span>
                        <span class="stat-label">‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" style="color:var(--secondary);">‡ß≥35</span>
                        <span class="stat-label">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ñ‡¶∞‡¶ö</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" style="color:var(--secondary);">245</span>
                        <span class="stat-label">‡¶¶‡¶æ‡¶§‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="police" class="page-section">
        <div class="container section">
            <h2 class="section-title">üëÆ ‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂ ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</h2>
            <div id="emergencyAlerts"></div>
            <div class="grid-2">
                <div class="card">
                    <h3>üìπ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</h3>
                    <div class="live-feed">
                        <span class="live-badge">üî¥ LIVE</span>
                        <div style="max-width:400px;aspect-ratio:16/9;margin:0 auto;border-radius:10px;overflow:hidden;background:#000;">
                            <img src="http://192.168.0.118/stream" alt="ESP32-CAM" style="width:100%;height:100%;object-fit:cover;">
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3>üìç ‡¶Æ‡ßá‡¶∂‡¶ø‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®</h3>
                    <div style="background:#e2e8f0;padding:1.5rem;border-radius:8px;">
                        <p><strong>ID:</strong> VM-DHK-01</p>
                        <p><strong>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</strong> IUBAT, Dhaka</p>
                        <p><strong>‡¶•‡¶æ‡¶®‡¶æ:</strong> Kamarpara (0.8 km)</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
                <div id="emergencyHistory"><div class="loading">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div></div>
            </div>
        </div>
    </div>

    <div id="fire" class="page-section">
        <div class="container section">
            <h2 class="section-title">üöí Fire Service Portal</h2>
            <div id="fireAlerts"></div>
            <div class="grid-2">
                <div class="card">
                    <h3>üî• Fire Detection Status</h3>
                    <div id="fireStatus" style="background:#d1fae5;padding:1.5rem;border-radius:8px;text-align:center;">
                        <div style="font-size:3rem;margin-bottom:0.5rem;">‚úÖ</div>
                        <div style="font-size:1.5rem;font-weight:bold;color:var(--secondary);">No Fire Detected</div>
                        <div style="color:#047857;margin-top:0.5rem;">System Normal</div>
                    </div>
                </div>
                <div class="card">
                    <h3>üìç ‡¶Æ‡ßá‡¶∂‡¶ø‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®</h3>
                    <div style="background:#e2e8f0;padding:1.5rem;border-radius:8px;">
                        <p><strong>ID:</strong> VM-DHK-01</p>
                        <p><strong>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</strong> IUBAT, Dhaka</p>
                        <p><strong>‡¶®‡¶ø‡¶ï‡¶ü‡¶§‡¶Æ ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßá‡¶∂‡¶®:</strong> Uttara (2.5 km)</p>
                        <p><strong>Response Time:</strong> ~5 minutes</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>üìπ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</h3>
                <div class="live-feed">
                    <span class="live-badge">üî¥ LIVE</span>
                    <div style="max-width:600px;aspect-ratio:16/9;margin:0 auto;border-radius:10px;overflow:hidden;background:#000;">
                        <img src="http://192.168.0.118/stream" alt="ESP32-CAM" style="width:100%;height:100%;object-fit:cover;">
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>üî• Fire Alert History</h3>
                <div id="fireHistory"><div class="loading">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div></div>
            </div>
        </div>
    </div>

    <!-- Fire Alert Modal -->
    <div id="fireAlertModal" class="fire-alert-modal">
        <div class="fire-alert-content">
            <div class="fire-icon">üî•</div>
            <h1 style="font-size:3rem;margin-bottom:1rem;text-shadow:2px 2px 4px rgba(0,0,0,0.5);">FIRE DETECTED!</h1>
            <h2 style="font-size:1.5rem;margin-bottom:2rem;">‡¶Ü‡¶ó‡ßÅ‡¶® ‡¶∏‡¶®‡¶æ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!</h2>
            <div style="background:rgba(255,255,255,0.2);padding:1.5rem;border-radius:10px;margin-bottom:2rem;">
                <p style="font-size:1.2rem;margin-bottom:0.5rem;"><strong>Location:</strong> VM-DHK-01, IUBAT</p>
                <p style="font-size:1.2rem;"><strong>Fire Station Alerted:</strong> Uttara (2.5 km)</p>
            </div>
            <button onclick="acknowledgeFireAlert()" class="btn" style="background:white;color:#dc2626;font-size:1.2rem;padding:1rem 2rem;font-weight:bold;">üöí Acknowledge & Respond</button>
        </div>
    </div>

    <audio id="fireAlarmSound" loop>
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjGH0fPTgjMGHm7A7+OZSBAKTJ7h8LNnHgg=" type="audio/wav">
    </audio>

    <script>
        const CH = '3213475';
        const EMP = [
            {uid:"233B1FBE",name:"Harun Rashid"},{uid:"63698205",name:"Abdul Karim"},
            {uid:"A58C8F02",name:"Sadia Rahman"},{uid:"9D8B3602",name:"Tanvir Ahmed"},
            {uid:"87069002",name:"Nusrat Jahan"},{uid:"A242CA01",name:"Rafiul Islam"}
        ];
        let meals={};
        EMP.forEach(e=>meals[e.uid]=0);
        let currentFireAlert = false;
        let currentEmergencyAlert = false;
        let fireAlarmPlaying = false;
        let acknowledgedFireAlerts = new Set(); // Track acknowledged alerts
        let activeFireAlertId = null; // Current fire alert ID for response

        function showSection(s){
            document.querySelectorAll('.page-section').forEach(p=>p.classList.remove('active'));
            document.getElementById(s).classList.add('active');
            if(s==='tracking'||s==='police'||s==='fire')loadData();
        }

        function playFireAlarm() {
            const audio = document.getElementById('fireAlarmSound');
            if (!fireAlarmPlaying) {
                audio.play().catch(e => console.log('Audio play failed:', e));
                fireAlarmPlaying = true;
            }
        }

        function stopFireAlarm() {
            const audio = document.getElementById('fireAlarmSound');
            audio.pause();
            audio.currentTime = 0;
            fireAlarmPlaying = false;
        }

        function acknowledgeFireAlert() {
            document.getElementById('fireAlertModal').classList.remove('active');
            stopFireAlarm();
            
            // Send response to ThingSpeak
            if(activeFireAlertId) {
                sendFireResponse(activeFireAlertId);
                acknowledgedFireAlerts.add(activeFireAlertId);
                console.log('Fire response sent for alert:', activeFireAlertId);
            }
            
            currentFireAlert = false;
            activeFireAlertId = null;
        }

        async function sendFireResponse(alertId) {
            try {
                // Send fire response to ThingSpeak
                // field7 = "FIRE_RESPONSE" to indicate fire service responded
                // field8 = alert timestamp for tracking
                const url = `https://api.thingspeak.com/update?api_key=${writeAPIKey}`;
                const params = `&field1=FIRE_SERVICE&field3=FIRE_RESPONSE&field7=${alertId}&field8=${new Date().toISOString()}`;
                
                await fetch(url + params);
                console.log('Fire response logged to server');
                
                // Reload data to show updated status
                setTimeout(() => loadData(), 2000);
            } catch(e) {
                console.error('Failed to send fire response:', e);
            }
        }

        async function loadData(){
            try{
                const r=await fetch(`https://api.thingspeak.com/channels/${CH}/feeds.json?results=100`);
                const d=await r.json();
                if(d.feeds&&d.feeds.length>0){
                    processData(d.feeds);
                }
            }catch(e){console.error(e);}
        }

        function processData(feeds){
            EMP.forEach(e=>meals[e.uid]=0);
            let total=0,today=0,emerg=0;
            const now=new Date(),tod=now.toISOString().split('T')[0];
            
            feeds.forEach(f=>{
                if(f.field1&&f.field2&&f.field3){
                    const uid=f.field1,mc=parseInt(f.field2)||0,st=f.field3;
                    if(meals[uid]!==undefined)meals[uid]=Math.max(meals[uid],mc);
                    if(st==='SUCCESS'){
                        total++;
                        if(f.created_at.startsWith(tod))today++;
                    }
                    if(st==='EMERGENCY'||st==='FIRE_ALERT')emerg++;
                }
            });

            document.getElementById('impactCounter').textContent=total;
            document.getElementById('todayMeals').textContent=today;
            document.getElementById('monthMeals').textContent=total;
            document.getElementById('emergencyHandled').textContent=emerg;

            // Today eaten list
            let eaten='<div class="alert alert-success"><strong>'+0+'</strong> ‡¶ú‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ü‡¶ú ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá</div>';
            let eatenList='<div class="table-container"><table><thead><tr><th>‡¶®‡¶æ‡¶Æ</th><th>RFID</th><th>‡¶∏‡¶Æ‡¶Ø‡¶º</th><th>‡¶Æ‡¶ø‡¶≤ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</th></tr></thead><tbody>';
            let eatenCount=0;
            const todayFeeds=feeds.filter(f=>f.created_at.startsWith(tod)&&f.field3==='SUCCESS');
            const todayUIDs=new Set();
            todayFeeds.forEach(f=>{todayUIDs.add(f.field1);});
            
            EMP.forEach(e=>{
                if(todayUIDs.has(e.uid)){
                    eatenCount++;
                    const lastToday=todayFeeds.reverse().find(f=>f.field1===e.uid);
                    const time=lastToday?new Date(lastToday.created_at).toLocaleTimeString('bn-BD'):'';
                    const mealCount=meals[e.uid]||0;
                    eatenList+=`<tr><td><strong>${e.name}</strong></td><td>${e.uid}</td><td>${time}</td><td><span class="badge badge-success">${mealCount}/3</span></td></tr>`;
                }
            });
            eatenList+='</tbody></table></div>';
            eaten='<div class="alert alert-success"><strong>'+eatenCount+'</strong> ‡¶ú‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ü‡¶ú ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá</div>';
            document.getElementById('eatenToday').innerHTML=eaten+(eatenCount>0?eatenList:'<p style="text-align:center;color:#666;padding:2rem;">‡¶Ü‡¶ú ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßá‡¶â ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶®‡ßá‡¶Ø‡¶º‡¶®‡¶ø</p>');

            // Not eaten today
            let notEaten='<div class="alert alert-warning" style="background:#fef3c7;color:#d97706;border-left:4px solid #f59e0b;"><strong>'+0+'</strong> ‡¶ú‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ü‡¶ú ‡¶è‡¶ñ‡¶®‡ßã ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div>';
            let notEatenList='<div class="table-container"><table><thead><tr><th>‡¶®‡¶æ‡¶Æ</th><th>RFID</th><th>‡¶∂‡ßá‡¶∑ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</th></tr></thead><tbody>';
            let notEatenCount=0;
            
            EMP.forEach(e=>{
                if(!todayUIDs.has(e.uid)){
                    notEatenCount++;
                    const lastFeed=feeds.find(f=>f.field1===e.uid&&f.field3==='SUCCESS');
                    const lastDate=lastFeed?new Date(lastFeed.created_at).toLocaleDateString('bn-BD'):'‡¶ï‡¶ñ‡¶®‡ßã ‡¶®‡¶Ø‡¶º';
                    notEatenList+=`<tr><td><strong>${e.name}</strong></td><td>${e.uid}</td><td>${lastDate}</td></tr>`;
                }
            });
            notEatenList+='</tbody></table></div>';
            notEaten='<div class="alert alert-warning" style="background:#fef3c7;color:#d97706;border-left:4px solid #f59e0b;"><strong>'+notEatenCount+'</strong> ‡¶ú‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ü‡¶ú ‡¶è‡¶ñ‡¶®‡ßã ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div>';
            document.getElementById('notEatenToday').innerHTML=notEaten+(notEatenCount>0?notEatenList:'<p style="text-align:center;color:#666;padding:2rem;">‡¶∏‡¶¨‡¶æ‡¶á ‡¶Ü‡¶ú ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá! üéâ</p>');

            // Employee tracking
            let eh='';
            EMP.forEach(e=>{
                const m=meals[e.uid]||0;
                eh+=`<div class="employee-item"><div><strong>${e.name}</strong><br><small>${e.uid}</small></div>`;
                eh+=`<div class="meal-dots">`;
                for(let i=1;i<=3;i++){
                    eh+=`<div class="meal-dot ${i<=m?'taken':''}">${i<=m?'‚úì':i}</div>`;
                }
                eh+=`</div></div>`;
            });
            document.getElementById('employeeTracking').innerHTML=eh;

            // Emergency and Fire alerts
            let ea='',eh2='<div class="table-container"><table><thead><tr><th>‡¶∏‡¶Æ‡¶Ø‡¶º</th><th>‡¶ß‡¶∞‡¶®</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th></tr></thead><tbody>';
            let hasAlert=false;
            let hasActiveEmergency=false;
            let hasActiveFire=false;
            
            feeds.slice().reverse().forEach(f=>{
                if(f.field5==='1'||f.field6==='1'||f.field3==='EMERGENCY'||f.field3==='FIRE_ALERT'){
                    const isRecent = (new Date() - new Date(f.created_at)) < 300000; // 5 minutes
                    
                    if(!hasAlert&&(f.field5==='1'||f.field3==='EMERGENCY')&&isRecent){
                        ea+=`<div class="emergency-alert"><h3>üö® ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ</h3><p><strong>‡¶∏‡¶Æ‡¶Ø‡¶º:</strong> ${new Date(f.created_at).toLocaleString('bn-BD')}</p><p><strong>‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:</strong> VM-DHK-01, IUBAT</p></div>`;
                        hasAlert=true;
                        hasActiveEmergency=true;
                        currentEmergencyAlert=true;
                    }
                    
                    if(f.field6==='1'||f.field3==='FIRE_ALERT'){
                        const alertTime = f.created_at;
                        const alertId = f.entry_id || alertTime; // Unique ID for each alert
                        
                        // Fire alert only active for 2 minutes (120 seconds)
                        const fireAlertAge = (new Date() - new Date(f.created_at)) / 1000;
                        const isFireActive = fireAlertAge <= 120; // 2 minutes = 120 seconds
                        
                        if(isFireActive && !currentFireAlert){
                            // Only show if not already acknowledged
                            if(!acknowledgedFireAlerts.has(alertId)){
                                hasActiveFire=true;
                                currentFireAlert=true;
                                activeFireAlertId = alertId;
                                
                                // Store alert info in modal
                                const modal = document.getElementById('fireAlertModal');
                                modal.dataset.alertTime = alertTime;
                                modal.dataset.alertId = alertId;
                                modal.classList.add('active');
                                playFireAlarm();
                            }
                        }
                    }
                    
                    const tp=f.field5==='1'||f.field3==='EMERGENCY'?'‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø':'‡¶Ü‡¶ó‡ßÅ‡¶®';
                    eh2+=`<tr><td>${new Date(f.created_at).toLocaleString('bn-BD')}</td><td>${tp}</td><td><span class="badge badge-warning">‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶ø‡¶§</span></td></tr>`;
                }
            });
            
            if(!hasActiveEmergency) currentEmergencyAlert = false;
            
            eh2+='</tbody></table></div>';
            document.getElementById('emergencyAlerts').innerHTML=ea;
            document.getElementById('emergencyHistory').innerHTML=eh2||'<p>‡¶ï‡ßã‡¶® ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶ò‡¶ü‡¶®‡¶æ ‡¶®‡ßá‡¶á</p>';
            
            // Update Fire Service Portal
            let fireAlertsHtml='';
            let fireHistoryHtml='<div class="table-container"><table><thead><tr><th>‡¶∏‡¶Æ‡¶Ø‡¶º</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th><th>Response Time</th></tr></thead><tbody>';
            let fireCount=0;
            
            // Track fire alerts and their responses
            let fireAlerts = {};
            
            feeds.slice().reverse().forEach(f=>{
                // Detect fire alerts
                if(f.field6==='1'||f.field3==='FIRE_ALERT'){
                    const alertId = f.entry_id || f.created_at;
                    if(!fireAlerts[alertId]) {
                        fireAlerts[alertId] = {
                            time: new Date(f.created_at),
                            response: null,
                            responseTime: null
                        };
                    }
                }
                
                // Detect fire responses
                if(f.field3==='FIRE_RESPONSE' && f.field7) {
                    const originalAlertId = f.field7;
                    if(fireAlerts[originalAlertId]) {
                        fireAlerts[originalAlertId].response = new Date(f.created_at);
                        const timeDiff = Math.floor((new Date(f.created_at) - fireAlerts[originalAlertId].time) / 1000);
                        fireAlerts[originalAlertId].responseTime = timeDiff;
                    }
                }
            });
            
            // Display fire alerts
            Object.keys(fireAlerts).forEach(alertId => {
                const alert = fireAlerts[alertId];
                fireCount++;
                
                // Fire alert active for only 2 minutes
                const alertAge = (new Date() - alert.time) / 1000; // in seconds
                const isFireActive = alertAge <= 120; // 2 minutes
                
                if(isFireActive && !fireAlertsHtml && !alert.response){
                    const remainingTime = Math.max(0, Math.ceil(120 - alertAge));
                    fireAlertsHtml=`<div style="background:linear-gradient(135deg, #dc2626, #991b1b);color:white;padding:2rem;border-radius:10px;margin-bottom:1.5rem;animation:pulse 2s infinite;">
                        <h3 style="font-size:2rem;margin-bottom:1rem;">üî• ACTIVE FIRE ALERT</h3>
                        <p style="font-size:1.2rem;"><strong>Time:</strong> ${alert.time.toLocaleString('bn-BD')}</p>
                        <p style="font-size:1.2rem;"><strong>Location:</strong> VM-DHK-01, IUBAT, Dhaka</p>
                        <p style="font-size:1.2rem;"><strong>Status:</strong> ${alert.response ? 'Responded' : 'Waiting for Response'}</p>
                        <p style="font-size:1.5rem;margin-top:1rem;font-weight:bold;">‚è∞ Alert expires in: ${remainingTime}s</p>
                    </div>`;
                }
                
                const statusBadge = alert.response 
                    ? `<span class="badge badge-success">Responded</span>` 
                    : (isFireActive ? `<span class="badge badge-danger">Active</span>` : `<span class="badge" style="background:#94a3b8;color:white;">Expired</span>`);
                    
                const responseTime = alert.response && alert.responseTime
                    ? `${alert.responseTime}s`
                    : (isFireActive ? 'Pending' : 'Timeout');
                
                fireHistoryHtml+=`<tr>
                    <td>${alert.time.toLocaleString('bn-BD')}</td>
                    <td>${statusBadge}</td>
                    <td>${responseTime}</td>
                </tr>`;
            });
            
            fireHistoryHtml+='</tbody></table></div>';
            
            document.getElementById('fireAlerts').innerHTML=fireAlertsHtml;
            document.getElementById('fireHistory').innerHTML=fireCount>0?fireHistoryHtml:'<p style="text-align:center;color:#666;padding:2rem;">‡¶ï‡ßã‡¶® ‡¶Ü‡¶ó‡ßÅ‡¶®‡ßá‡¶∞ ‡¶ò‡¶ü‡¶®‡¶æ ‡¶®‡ßá‡¶á</p>';
            
            // Update Fire Status Display
            const hasUnrespondedFire = Object.values(fireAlerts).some(a => {
                const alertAge = (new Date() - a.time) / 1000;
                return !a.response && alertAge <= 120; // Active for 2 minutes only
            });
            
            if(hasUnrespondedFire){
                document.getElementById('fireStatus').innerHTML=`
                    <div style="font-size:3rem;margin-bottom:0.5rem;">üî•</div>
                    <div style="font-size:1.5rem;font-weight:bold;color:#dc2626;">FIRE DETECTED!</div>
                    <div style="color:#991b1b;margin-top:0.5rem;">Waiting for Response</div>
                `;
                document.getElementById('fireStatus').style.background='linear-gradient(135deg, #fee2e2, #fecaca)';
            } else {
                document.getElementById('fireStatus').innerHTML=`
                    <div style="font-size:3rem;margin-bottom:0.5rem;">‚úÖ</div>
                    <div style="font-size:1.5rem;font-weight:bold;color:var(--secondary);">No Fire Detected</div>
                    <div style="color:#047857;margin-top:0.5rem;">System Normal</div>
                `;
                document.getElementById('fireStatus').style.background='#d1fae5';
            }
        }

        function submitTender(e){
            e.preventDefault();
            const name=document.getElementById('restName').value;
            const price=document.getElementById('mealPrice').value;
            alert(`‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!\n\n‡¶∞‡ßá‡¶∏‡ßç‡¶§‡ßã‡¶∞‡¶æ‡¶Å: ${name}\n‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥${price}\n\n‡¶Ü‡¶Æ‡¶∞‡¶æ 24 ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶¨‡•§`);
            e.target.reset();
        }
        
        function submitDonation(e){
            e.preventDefault();
            const amt=document.getElementById('donationAmount').value;
            const name=document.getElementById('donorName').value;
            const txn=document.getElementById('transactionId').value;
            let msg=`üíö ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶ ${name}!\n\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡ß≥${amt} ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶¶‡¶æ‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§\n\n‡¶è‡¶á ‡¶Ö‡¶∞‡ßç‡¶• ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ${Math.floor(amt/35)} ‡¶ú‡¶® ‡¶∂‡¶ø‡¶∂‡ßÅ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡¶æ‡¶¨‡ßá‡•§`;
            if(txn)msg+=`\n\nTransaction ID: ${txn}`;
            msg+='\n\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶∞‡¶∏‡¶ø‡¶¶ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá‡•§\n\nbKash ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞: 01964301859';
            alert(msg);
            e.target.reset();
        }
        
        function selectDonation(el,amt){
            document.querySelectorAll('.donation-option').forEach(o=>o.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('donationAmount').value=amt;
        }

        loadData();
        setInterval(loadData,15000);
    </script>
</body>
</html>
